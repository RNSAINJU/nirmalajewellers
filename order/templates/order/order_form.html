{% extends 'base.html' %}

{% block content %}

<h1 class="text-center mb-4">{{ form_title }}</h1>

<div class="card shadow">
    <div class="card-body">

        <form method="post" novalidate id="order-form">
            {% csrf_token %}

            <!-- Order fields -->
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">{{ form.order_date.label }}</label>
                    {{ form.order_date }}
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{ form.deliver_date.label }}</label>
                    {{ form.deliver_date }}
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{ form.customer_name.label }}</label>
                    {{ form.customer_name }}
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{ form.phone_number.label }}</label>
                    {{ form.phone_number }}
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{ form.payment_mode.label }}</label>
                    {{ form.payment_mode }}
                </div>
                <div class="col-md-6">
                    <label class="form-label">{{ form.status.label }}</label>
                    {{ form.status }}
                </div>
            </div>

            <hr class="my-4" />
            <h5 class="mb-3">Ornaments (Add one or more)</h5>

            {{ formset.management_form }}

            {% if formset.non_form_errors %}
            <div class="alert alert-danger">{{ formset.non_form_errors }}</div>
            {% endif %}

            <!-- Submit buttons -->
            <div class="mt-4 d-flex justify-content-end gap-2">
                <button type="submit" class="btn btn-success">Save Order</button>
                <a href="{% url 'order:list' %}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>

      
       

        <form method="post" novalidate id="ornament-form">
            {% csrf_token %}

            <!-- {{ formset.management_form }} -->
            <!-- Modal trigger (must be OUTSIDE the form) -->
            <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#ornamentModal">
              Add Ornaments
            </button>



          <!-- MODAL OUTSIDE THE FORM (IMPORTANT) -->
          <div class="modal fade" id="ornamentModal" tabindex="-1">
              <div class="modal-dialog modal-xl">
                  <div class="modal-content">

                      <div class="modal-header">
                          <h5 class="modal-title">Add Multiple Ornaments</h5>
                          <button class="btn-close" data-bs-dismiss="modal"></button>
                      </div>

                      <div class="modal-body">

                          <table class="table table-bordered table-sm mt-3">
                              <thead>
                                  <tr>
                                      <th>Ornament Name</th>
                                      <th>Metal Type</th>
                                      <th>Weight</th>
                                      <th>Jarti</th>
                                      <th>Jyala</th>
                                      <th>Rate</th>
                                      <th>Size</th>
                                      <th>Stone</th>
                                      <th>Total</th>
                                      <th>Delete</th>
                                  </tr>
                              </thead>

                              <tbody id="ornament-formset-body">
                                  {% for form in formset %}
                                  <tr class="ornament-formset-row">
                                      <td>{{ form.ornament_name }}</td>
                                      <td>{{ form.metal_type }}</td>
                                      <td>{{ form.weight }}</td>
                                      <td>{{ form.jarti }}</td>
                                      <td>{{ form.jyala }}</td>
                                      <td>{{ form.rate }}</td>
                                      <td>{{ form.size }}</td>
                                      <td>{{ form.stone }}</td>
                                      <td>{{ form.total }}</td>
                                      <td>{{ form.DELETE }}</td>
                                  </tr>
                                  {% endfor %}
                              </tbody>
                          </table>

                          <button class="btn btn-success" onclick="addRow()">+ Add Row</button>

                      </div>

                      <div class="modal-footer">
                          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                          <button class="btn btn-primary" onclick="saveOrnaments()">Save All</button>
                      </div>
                  </div>
              </div>
          </form>

</div>
</div>
</div>


<!-- BOOTSTRAP JS (only once) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<!-- Your JS logic -->
<script>
let rowCount = 0;

function addRow() {
    rowCount++;

    const row = `
        <tr>
            <td><input type="text" class="form-control"></td>
            <td><input type="text" class="form-control"></td>
            <td><input type="number" class="form-control"></td>
            <td><input type="text" class="form-control"></td>
            <td><input type="text" class="form-control"></td>
            <td><input type="number" class="form-control"></td>
            <td><input type="text" class="form-control"></td>
            <td><input type="text" class="form-control"></td>
            <td><input type="number" class="form-control"></td>
            <td><button class="btn btn-danger btn-sm" onclick="deleteRow(this)">X</button></td>
        </tr>
    `;

    document.querySelector("#ornament-formset-body").insertAdjacentHTML("beforeend", row);
}

function deleteRow(btn) {
    btn.closest("tr").remove();
}

function saveOrnaments() {
    alert("Saving multiple ornaments will be implemented here.");
}
</script>

{% endblock %}
