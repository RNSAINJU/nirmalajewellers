{% extends 'base.html' %}

{% block content %}
<style>
  .sheet {
    background: #fff;
    padding: 24px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
  }
  .sheet-header { text-align: center; margin-bottom: 18px; }
  .sheet-header .title { font-weight: 700; font-size: 1.4rem; }
  .sheet-header .subtitle { color: #4b5563; font-size: 0.95rem; }
  .note { margin-top: 14px; }
  .note-title { font-weight: 700; margin-bottom: 6px; }
  .note-table { width: 100%; border-collapse: collapse; margin-bottom: 18px; }
  .note-table th,
  .note-table td { border: 1px solid #1f2937; padding: 8px 10px; font-size: 0.95rem; }
  .note-table th { background: #e5e7eb; text-align: center; }
  .note-table td:nth-child(1) { text-align: center; }
  .note-table td:nth-child(3), .note-table td:nth-child(5) { text-align: right; }
  .total-row { font-weight: 700; background: #f3f4f6; }
  .actions { display: flex; gap: 12px; justify-content: center; margin-top: 14px; }
  .actions a, .actions button { padding: 10px 16px; border-radius: 6px; border: 1px solid #111827; background: #111827; color: #fff; font-weight: 600; cursor: pointer; text-decoration: none; }
  .actions .secondary { background: #fff; color: #111827; }
  @media print {
    .actions,
    .navbar,
    .sidebar,
    #sidebarOverlay,
    .btn,
    .alert { display: none !important; }
    .content { margin: 0; padding: 0; }
    body { background: #fff; }
  }
</style>

{% load bs_filters %}

<div class="sheet">
  <div class="sheet-header">
    <div class="title">Nirmala Jewellers Pvt.Ltd.</div>
    <div class="subtitle">SuryaBinayak Municipality 08, Bhaktapur</div>
    <div class="subtitle">Fiscal Year: 2078-079 (32 Asadh 2079, 16 July 2022)</div>
    <div class="subtitle">PAN 610085158</div>
  </div>

  <div class="note">
    <div class="note-title">Note 13.1 : Detail of Previous Year Remaining Stock</div>
    <table class="note-table">
      <thead>
        <tr>
          <th>S.N.</th><th>Item Details</th><th>Qty.</th><th>Unit</th><th>Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for row in opening_stock_rows %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ row.label }}</td>
            <td>{{ row.qty|floatformat:2 }}</td>
            <td>Gms.</td>
            <td>{{ row.amount|floatformat:2 }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="5" style="text-align: center; color: #999;">No opening stock data available</td></tr>
        {% endfor %}
        {% if opening_stock_rows %}
        <tr class="total-row">
          <td colspan="2">Totals</td>
          <td>{{ opening_stock_totals.qty|floatformat:2 }}</td>
          <td></td>
          <td>{{ opening_stock_totals.amount|floatformat:2 }}</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <div class="note">
    <div class="note-title">Note 14.1 : Detail of Sales</div>
    <table class="note-table">
      <thead>
        <tr>
          <th>S.N.</th><th>Item Details</th><th>Qty.</th><th>Unit</th><th>Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for row in sales_rows %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ row.label }}</td>
            <td>{{ row.qty|floatformat:2 }}</td>
            <td>Gms.</td>
            <td>{{ row.amount|floatformat:2 }}</td>
          </tr>
        {% endfor %}
        <tr class="total-row">
          <td colspan="2">Totals</td>
          <td>{{ sales_totals.qty|floatformat:2 }}</td>
          <td></td>
          <td>{{ sales_totals.amount|floatformat:2 }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="note">
    <div class="note-title">Note 15.1 : Detail of Purchase</div>
    <table class="note-table">
      <thead>
        <tr>
          <th>S.N.</th><th>Item Details</th><th>Qty.</th><th>Unit</th><th>Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for row in purchase_rows %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ row.label }}</td>
            <td>{{ row.qty|floatformat:2 }}</td>
            <td>Gms.</td>
            <td>{{ row.amount|floatformat:2 }}</td>
          </tr>
        {% endfor %}
        <tr class="total-row">
          <td colspan="2">Totals</td>
          <td>{{ purchase_totals.qty|floatformat:2 }}</td>
          <td></td>
          <td>{{ purchase_totals.amount|floatformat:2 }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="note">
    <div class="note-title">Note 16.1 : Detail of Stock</div>
    <table class="note-table">
      <thead>
        <tr>
          <th>S.N.</th><th>Item Details</th><th>Qty.</th><th>Unit</th><th>Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for row in stock_rows %}
          <tr {% if row.label in 'Gold,Silver,Diamond' %} style="cursor:pointer;" onclick="window.location='?category={{ row.label }}'" {% endif %}>
            <td>{{ forloop.counter }}</td>
            <td>{{ row.label }}</td>
            <td>{{ row.qty|floatformat:2 }}</td>
            <td>Gms.</td>
            <td>{{ row.amount|floatformat:2 }}</td>
          </tr>
        {% endfor %}
          {% if category_ornaments and selected_category %}
            <div class="note">
              <div class="note-title">All Ornaments for Category: {{ selected_category }}</div>
              <table class="note-table">
                <thead>
                  <tr>
                    <th>S.N.</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Weight</th>
                    <th>Purity</th>
                    <th>Jarti</th>
                    <th>Jyala</th>
                    <th>Created At</th>
                  </tr>
                </thead>
                <tbody>
                  {% for ornament in category_ornaments %}
                    <tr>
                      <td>{{ forloop.counter }}</td>
                      <td>{{ ornament.name }}</td>
                      <td>{{ ornament.type }}</td>
                      <td>{{ ornament.weight|floatformat:2 }}</td>
                      <td>{{ ornament.purity }}</td>
                      <td>{{ ornament.jarti|default_if_none:"" }}</td>
                      <td>{{ ornament.jyala|default_if_none:"" }}</td>
                      <td>{{ ornament.created_at|date:'Y-m-d' }}</td>
                    </tr>
                  {% empty %}
                    <tr><td colspan="8" style="text-align:center; color:#999;">No ornaments found for this category.</td></tr>
                  {% endfor %}
                </tbody>
              </table>
              <div class="actions">
                <a class="secondary" href="?">Back to Stock Report</a>
              </div>
            </div>
          {% endif %}
        <tr class="total-row">
          <td colspan="2">Totals</td>
          <td>{{ stock_totals.qty|floatformat:2 }}</td>
          <td></td>
          <td>{{ stock_totals.amount|floatformat:2 }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="actions">
    <a class="secondary" href="/">Back to Dashboard</a>
    <button type="button" onclick="window.print()">Print</button>
  </div>
</div>
{% endblock %}
