{% extends 'base.html' %}

{% block content %}
  <!-- Order Details -->
  {% if order %}
    <div class="card mb-4">
      <div class="card-header"><strong>Order Details</strong></div>
      <div class="card-body">
        <div><strong>Order No:</strong> 
          <a href="{% url 'order:update' order.sn %}" target="_blank" class="btn btn-link p-0 align-baseline" title="Edit Order">{{ order.sn }}</a>
        </div>
        <div><strong>Order Date (BS):</strong> {{ order.order_date }}</div>
        <div><strong>Customer Name:</strong> {{ order.customer_name }}</div>
        <div><strong>Phone:</strong> {{ order.phone_number }}</div>
        <div><strong>Status:</strong> {{ order.get_status_display }}</div>
        <div><strong>Order Type:</strong> {{ order.get_order_type_display }}</div>
        <div><strong>Description:</strong> {{ order.description }}</div>
      </div>
    </div>
  {% endif %}

  <!-- Ornaments Section (read-only, like order create) -->
  {% if order_ornaments %}
    <div class="card mb-4">
      <div class="card-header"><strong>Ornaments</strong></div>
      <div class="card-body p-2">
        <div class="table-responsive">
          <table class="table table-bordered table-sm mb-0">
            <thead class="table-light">
              <tr>
                <th>Code</th>
                <th>Name</th>
                <th>Metal</th>
                <th>Karat</th>
                <th>Weight</th>
                <th>Jarti</th>
                <th>Jyala</th>
              </tr>
            </thead>
            <tbody>
              {% for line in order_ornaments %}
                <tr>
                  <td>{{ line.ornament.code }}</td>
                  <td>{{ line.ornament.ornament_name }}</td>
                  <td>{{ line.ornament.get_metal_type_display }}</td>
                  <td>{{ line.ornament.get_type_display }}</td>
                  <td>{{ line.ornament.weight }}</td>
                  <td>{{ line.ornament.jarti }}</td>
                  <td>{{ line.ornament.jyala }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Raw Gold & Silver Section (read-only, like order create) -->
  {% if sale_metals %}
    <div class="card mb-4">
      <div class="card-header"><strong>Raw Gold & Silver</strong></div>
      <div class="card-body p-2">
        <div class="table-responsive">
          <table class="table table-bordered table-sm mb-0">
            <thead class="table-light">
              <tr>
                <th>Stock Type</th>
                <th>Metal</th>
                <th>Purity</th>
                <th>Quantity (g)</th>
                <th>Rate Unit</th>
                <th>Rate/gram</th>
                <th>Remarks</th>
                <th>Line Amount</th>
              </tr>
            </thead>
            <tbody>
              {% for metal in sale_metals %}
                <tr>
                  <td>{{ metal.stock_type }}</td>
                  <td>{{ metal.get_metal_type_display }}</td>
                  <td>{{ metal.purity }}</td>
                  <td>{{ metal.quantity }}</td>
                  <td>{{ metal.get_rate_unit_display }}</td>
                  <td>{{ metal.rate_per_gram }}</td>
                  <td>{{ metal.remarks }}</td>
                  <td>{{ metal.line_amount }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Editable sale fields -->
  <div class="col-lg-6">
    <form method="post" class="card p-4 shadow-sm" novalidate>
      {% csrf_token %}
      <div class="mb-3">
        <label for="id_bill_no" class="form-label">Bill No</label>
        {{ form.bill_no }}
      </div>
      <div class="mb-3">
        <label for="id_sale_date" class="form-label">Sale Date (BS)</label>
        {{ form.sale_date }}
      </div>
      <div class="d-flex justify-content-end gap-2 mt-3">
        <button type="submit" class="btn btn-primary">Save</button>
        <a href="{% url 'sales:sales_list' %}" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
  <!-- Only the main sale form is needed for edit. Raw metal section and related JS removed. -->
{% endblock %}
