{% extends 'base.html' %}

{% block content %}
<style>
    .margin-header {
        background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
        color: #fff;
        padding: 24px;
        border-radius: 14px;
        margin-bottom: 24px;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.2);
    }
    .metric-card {
        background: #fff;
        border-radius: 12px;
        padding: 18px;
        box-shadow: 0 4px 14px rgba(15, 23, 42, 0.08);
        text-align: center;
        border: 1px solid #eef2f7;
    }
    .metric-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: #64748b;
        margin-bottom: 6px;
        font-weight: 600;
    }
    .metric-value {
        font-size: 24px;
        font-weight: 700;
        color: #0f172a;
    }
    .section-card {
        background: #fff;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
        margin-bottom: 24px;
        border: 1px solid #eef2f7;
    }
    .table thead th {
        background: #0f172a;
        color: #fff;
    }
</style>

<div class="container mt-4">
    <div class="margin-header">
        <h2 class="mb-1">Margin Analysis</h2>
        <div class="opacity-75">Monitor profit margins by product and category to guide pricing decisions.</div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="metric-card">
                <div class="metric-label">Total Revenue</div>
                <div class="metric-value">Rs {{ total_revenue|floatformat:2 }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card">
                <div class="metric-label">Total Profit</div>
                <div class="metric-value">Rs {{ total_profit|floatformat:2 }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card">
                <div class="metric-label">Overall Margin</div>
                <div class="metric-value">{{ overall_margin|floatformat:2 }}%</div>
            </div>
        </div>
    </div>

    <div class="section-card">
        <h5 class="mb-3">Margin by Product</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Metal</th>
                        <th>Purity</th>
                        <th class="text-end">Units</th>
                        <th class="text-end">Revenue</th>
                        <th class="text-end">Profit</th>
                        <th class="text-end">Margin %</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in products %}
                    <tr>
                        <td>{{ row.name }}</td>
                        <td>{{ row.metal }}</td>
                        <td>{{ row.purity }}</td>
                        <td class="text-end">{{ row.units }}</td>
                        <td class="text-end">Rs {{ row.revenue|floatformat:2 }}</td>
                        <td class="text-end">Rs {{ row.profit|floatformat:2 }}</td>
                        <td class="text-end">{{ row.margin|floatformat:2 }}%</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">No product data available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="section-card">
        <h5 class="mb-3">Margin by Category</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th class="text-end">Units</th>
                        <th class="text-end">Revenue</th>
                        <th class="text-end">Profit</th>
                        <th class="text-end">Margin %</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in categories %}
                    <tr>
                        <td>{{ row.name }}</td>
                        <td class="text-end">{{ row.units }}</td>
                        <td class="text-end">Rs {{ row.revenue|floatformat:2 }}</td>
                        <td class="text-end">Rs {{ row.profit|floatformat:2 }}</td>
                        <td class="text-end">{{ row.margin|floatformat:2 }}%</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">No category data available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
