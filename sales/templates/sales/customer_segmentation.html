{% extends 'base.html' %}

{% block content %}
<style>
    .segment-header {
        background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        color: #fff;
        padding: 24px;
        border-radius: 14px;
        margin-bottom: 24px;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.2);
    }
    .segment-card {
        background: #fff;
        border-radius: 12px;
        padding: 18px;
        box-shadow: 0 4px 14px rgba(15, 23, 42, 0.08);
        text-align: center;
        border: 1px solid #eef2f7;
    }
    .segment-label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: #64748b;
        margin-bottom: 6px;
        font-weight: 600;
    }
    .segment-value {
        font-size: 24px;
        font-weight: 700;
        color: #0f172a;
    }
    .section-card {
        background: #fff;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
        margin-bottom: 24px;
        border: 1px solid #eef2f7;
    }
    .table thead th {
        background: #0f172a;
        color: #fff;
    }
</style>

<div class="container mt-4">
    <div class="segment-header">
        <h2 class="mb-1">Customer Segmentation Analysis</h2>
        <div class="opacity-75">Identify segments by spending and repeat behavior for targeted campaigns.</div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="segment-card">
                <div class="segment-label">Total Customers</div>
                <div class="segment-value">{{ total_customers }}</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="segment-card">
                <div class="segment-label">High Value</div>
                <div class="segment-value">{{ high_value_count }}</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="segment-card">
                <div class="segment-label">Loyal (3+ Orders)</div>
                <div class="segment-value">{{ loyal_count }}</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="segment-card">
                <div class="segment-label">New (1 Order)</div>
                <div class="segment-value">{{ new_count }}</div>
            </div>
        </div>
    </div>

    <div class="section-card">
        <h5 class="mb-3">High Value Customers (Top 20% by Spend)</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th class="text-end">Orders</th>
                        <th class="text-end">Total Spend</th>
                        <th class="text-end">Avg Order</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in segments.high_value %}
                    <tr>
                        <td>{{ row.customer_name }}</td>
                        <td class="text-end">{{ row.order_count }}</td>
                        <td class="text-end">Rs {{ row.total_spend|floatformat:2 }}</td>
                        <td class="text-end">Rs {{ row.avg_order|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">No data available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="section-card">
        <h5 class="mb-3">Loyal Customers (3+ Orders)</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th class="text-end">Orders</th>
                        <th class="text-end">Total Spend</th>
                        <th class="text-end">Avg Order</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in segments.loyal %}
                    <tr>
                        <td>{{ row.customer_name }}</td>
                        <td class="text-end">{{ row.order_count }}</td>
                        <td class="text-end">Rs {{ row.total_spend|floatformat:2 }}</td>
                        <td class="text-end">Rs {{ row.avg_order|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">No data available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="section-card">
        <h5 class="mb-3">New Customers (1 Order)</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th class="text-end">Orders</th>
                        <th class="text-end">Total Spend</th>
                        <th class="text-end">Avg Order</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in segments.new %}
                    <tr>
                        <td>{{ row.customer_name }}</td>
                        <td class="text-end">{{ row.order_count }}</td>
                        <td class="text-end">Rs {{ row.total_spend|floatformat:2 }}</td>
                        <td class="text-end">Rs {{ row.avg_order|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">No data available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="section-card">
        <h5 class="mb-3">Other Customers</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th class="text-end">Orders</th>
                        <th class="text-end">Total Spend</th>
                        <th class="text-end">Avg Order</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in segments.others %}
                    <tr>
                        <td>{{ row.customer_name }}</td>
                        <td class="text-end">{{ row.order_count }}</td>
                        <td class="text-end">Rs {{ row.total_spend|floatformat:2 }}</td>
                        <td class="text-end">Rs {{ row.avg_order|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">No data available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
