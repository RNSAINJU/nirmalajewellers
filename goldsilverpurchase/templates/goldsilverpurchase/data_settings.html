{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
        <div class="d-flex justify-content-between align-items-center">
            <span>Data Settings</span>
            <i class="bi bi-gear"></i>
        </div>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Export Section -->
            <div class="col-md-6">
                <h5 class="mb-3">Export Data</h5>
                <p class="text-muted small">Download all your data (purchases, orders, sales, ornaments, payments) in one Excel file with multiple sheets.</p>
                <a href="{% url 'gsp:export_all_data' %}" class="btn btn-primary">
                    <i class="bi bi-download me-1"></i> Export All Data
                </a>
                
                <hr class="my-3">
                <h6 class="mb-2">Export Finance Data</h6>
                <p class="text-muted small">Download all finance data (expenses, employees, salaries, debtors, creditors) in one Excel file with multiple sheets.</p>
                <a href="{% url 'finance:finance_export_all' %}" class="btn btn-outline-primary">
                    <i class="bi bi-download me-1"></i> Export Finance Data (Excel)
                </a>
            </div>

            <!-- Import Section -->
            <div class="col-md-6">
                <h5 class="mb-3">Import Data</h5>
                <p class="text-muted small">Upload an exported Excel file to restore all data at once. Existing records with matching keys will be skipped.</p>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="file" name="import_file" accept=".xlsx" class="form-control" required>
                        <button class="btn btn-success" type="submit">
                            <i class="bi bi-upload me-1"></i> Import Data
                        </button>
                    </div>
                </form>
                
                <hr class="my-3">
                <h6 class="mb-2">Import Finance Data</h6>
                <p class="text-muted small">Upload a finance data Excel file to import expenses, employees, salaries, debtors, and creditors.</p>
                <form method="post" action="{% url 'finance:finance_import_all' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="file" name="file" accept=".xlsx" class="form-control" required>
                        <button class="btn btn-outline-success" type="submit">
                            <i class="bi bi-upload me-1"></i> Import Finance (Excel)
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <hr class="my-4">

        <!-- Delete Section -->
        <div class="row">
            <div class="col-md-6">
                <h5 class="mb-3 text-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i> Delete Customer Purchases
                </h5>
                <p class="text-muted small">Permanently delete all customer purchase records. <strong>This action cannot be undone.</strong></p>
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#deleteCustomerPurchasesModal">
                    <i class="bi bi-trash me-1"></i> Delete All Customer Purchases
                </button>
            </div>
            <div class="col-md-6">
                <h5 class="mb-3 text-danger">
                    <i class="bi bi-exclamation-triangle me-2"></i> Danger Zone
                </h5>
                <p class="text-muted small">Permanently delete all data from Gold/Silver Purchases, Customer Purchases, Ornaments, Orders, and Sales. <strong>This action cannot be undone.</strong></p>
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal">
                    <i class="bi bi-trash me-1"></i> Delete All Data
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Customer Purchases Modal -->
<div class="modal fade" id="deleteCustomerPurchasesModal" tabindex="-1" aria-labelledby="deleteCustomerPurchasesLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content border-warning">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="deleteCustomerPurchasesLabel">
                    <i class="bi bi-exclamation-circle me-2"></i> Delete All Customer Purchases
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3"><strong>Warning:</strong> You are about to permanently delete all customer purchase records.</p>
                <p class="text-danger mt-3"><strong>This action cannot be undone!</strong></p>
                
                <div class="form-group mb-3">
                    <label for="customerPurchasePassword" class="form-label"><strong>Enter Password:</strong></label>
                    <input type="password" id="customerPurchasePassword" class="form-control" placeholder="Enter password">
                    <small class="text-muted">Default password: <code>admin123</code></small>
                </div>

                <p class="small text-muted">Type <code>DELETE_CUSTOMER_PURCHASES</code> in the field below to confirm:</p>
                <input type="text" id="confirmCustomerInput" class="form-control" placeholder="Enter confirmation text">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="post" id="deleteCustomerPurchasesForm">
                    {% csrf_token %}
                    <input type="hidden" name="delete_customer_purchases" value="true">
                    <input type="hidden" name="customer_purchase_password" id="passwordInput" value="">
                    <input type="hidden" name="confirm_customer_delete" id="confirmCustomerToken" value="">
                    <button type="button" class="btn btn-warning" onclick="confirmDeleteCustomerPurchases()">
                        <i class="bi bi-trash me-1"></i> Delete Customer Purchases
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content border-danger">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmLabel">
                    <i class="bi bi-exclamation-circle me-2"></i> Confirm Data Deletion
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3"><strong>Warning:</strong> You are about to permanently delete all data from:</p>
                <ul class="list-unstyled">
                    <li><i class="bi bi-gem text-warning me-2"></i> Gold/Silver Purchases</li>
                    <li><i class="bi bi-gem text-info me-2"></i> Customer Purchases</li>
                    <li><i class="bi bi-gem text-success me-2"></i> Ornaments</li>
                    <li><i class="bi bi-bag text-primary me-2"></i> Orders</li>
                    <li><i class="bi bi-receipt text-secondary me-2"></i> Sales</li>
                </ul>
                <p class="text-danger mt-3"><strong>This action cannot be undone!</strong></p>
                <p class="small text-muted">Type <code>DELETE_ALL_DATA_CONFIRMED</code> in the field below to confirm:</p>
                <input type="text" id="confirmInput" class="form-control" placeholder="Enter confirmation text">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    <input type="hidden" name="delete_all" value="true">
                    <input type="hidden" name="confirm_delete" id="confirmToken" value="">
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                        <i class="bi bi-trash me-1"></i> Delete All Data
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function confirmDelete() {
        const input = document.getElementById("confirmInput").value;
        if (input === "DELETE_ALL_DATA_CONFIRMED") {
            document.getElementById("confirmToken").value = input;
            document.getElementById("deleteForm").submit();
        } else {
            alert("Confirmation text does not match. Deletion cancelled.");
        }
    }

    function confirmDeleteCustomerPurchases() {
        const password = document.getElementById("customerPurchasePassword").value;
        const confirmText = document.getElementById("confirmCustomerInput").value;

        if (password === "") {
            alert("Please enter the password.");
            return;
        }

        if (confirmText !== "DELETE_CUSTOMER_PURCHASES") {
            alert("Confirmation text does not match. Deletion cancelled.");
            return;
        }

        document.getElementById("passwordInput").value = password;
        document.getElementById("confirmCustomerToken").value = confirmText;
        document.getElementById("deleteCustomerPurchasesForm").submit();
    }
</script>
{% endblock %}


